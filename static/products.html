<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Products</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
</head>
<body class="p-4 bg-light">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1 class="mb-0">Products</h1>
      <a href="/" class="btn btn-outline-secondary">Back to Import</a>
    </div>

    <div class="mb-3 d-flex justify-content-between align-items-center">
      <div class="btn-group" role="group">
        <button id="refresh" class="btn btn-primary">Refresh</button>
        <button id="deleteAll" class="btn btn-danger">Delete All</button>
      </div>

      <div class="d-flex">
        <input
          type="text"
          id="filterSku"
          placeholder="Filter by SKU..."
          class="form-control me-2"
        />
        <button id="filterBtn" class="btn btn-outline-secondary">Search</button>
      </div>
    </div>

    <div class="mb-2 text-muted" id="summary"></div>

    <div class="table-responsive">
      <table class="table table-striped table-sm align-middle">
        <thead class="table-light">
          <tr>
            <th scope="col">ID</th>
            <th scope="col">SKU</th>
            <th scope="col">Name</th>
            <th scope="col">Price</th>
            <th scope="col">Active</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>

  <script>
    async function load() {
      const sku = document.getElementById('filterSku').value.trim();
      let url = '/api/products';
      if (sku) {
        url += `?sku=${encodeURIComponent(sku)}`;
      }

      const r = await fetch(url);
      if (!r.ok) {
        alert('Failed to load products');
        return;
      }

      const data = await r.json();

      // if backend returns { items: [...], total: ... } adjust here:
      // const items = Array.isArray(data) ? data : data.items || [];
      const items = Array.isArray(data) ? data : [];

      const tbody = document.getElementById('tbody');
      const summary = document.getElementById('summary');

      tbody.innerHTML = '';

      if (!items.length) {
        summary.textContent = 'No products found.';
        return;
      }

      summary.textContent = `Showing ${items.length} product(s)`;

      items.forEach(p => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${p.id}</td>
          <td>${p.sku}</td>
          <td>${p.name || ''}</td>
          <td>${p.price ?? ''}</td>
          <td>${p.active ? 'true' : 'false'}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    document.getElementById('refresh').addEventListener('click', load);
    document.getElementById('filterBtn').addEventListener('click', load);

    document.getElementById('deleteAll').addEventListener('click', async () => {
      if (!confirm('Are you sure? This cannot be undone.')) return;

      const res = await fetch('/api/products', { method: 'DELETE' });
      if (!res.ok) {
        alert('Failed to delete products');
        return;
      }
      load();
    });

    // Initial load on page open
    load();
  </script>
</body>
</html>
